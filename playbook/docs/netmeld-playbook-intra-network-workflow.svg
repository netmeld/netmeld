<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="2058pt" height="567pt"
 viewBox="0.00 0.00 2058.00 567.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 563)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-563 2054,-563 2054,4 -4,4"/>
<text text-anchor="middle" x="1025" y="-98.8" font-family="Times,serif" font-size="14.00" fill="#000000">Playbook Intra&#45;Network Execution Process</text>
<text text-anchor="start" x="773" y="-67.8" font-family="Times,serif" font-size="14.00" fill="#000000">Assume:</text>
<text text-anchor="start" x="773" y="-52.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;psql site &#45;c &quot;insert into playbook_roe_ip_nets values (&#39;1.2.3.0/24&#39;, true)&quot;</text>
<text text-anchor="start" x="773" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;nmdb&#45;playbook&#45;insert&#45;source &#45;&#45;intra&#45;network &#45;&#45;interface eth0 &#45;&#45;ip&#45;addr 1.2.3.4/24 &#45;&#45;stage 1</text>
<text text-anchor="start" x="773" y="-22.8" font-family="Times,serif" font-size="14.00" fill="#000000">Execution:</text>
<text text-anchor="start" x="773" y="-7.8" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;nmdb&#45;playbook &#45;&#45;intra&#45;network &#45;&#45;execute</text>
<g id="clust1" class="cluster">
<title>cluster_initial</title>
<polygon fill="none" stroke="#000000" points="8,-192 8,-547 411,-547 411,-192 8,-192"/>
<text text-anchor="middle" x="209.5" y="-531.8" font-family="Times,serif" font-size="14.00" fill="#000000">Initial setup and passive listening</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_phase1</title>
<polygon fill="none" stroke="#000000" points="449,-243 449,-551 850,-551 850,-243 449,-243"/>
<text text-anchor="middle" x="649.5" y="-535.8" font-family="Times,serif" font-size="14.00" fill="#000000">Phase 1</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_phase2</title>
<polygon fill="none" stroke="#000000" points="888,-122 888,-549 1701,-549 1701,-122 888,-122"/>
<text text-anchor="middle" x="1294.5" y="-533.8" font-family="Times,serif" font-size="14.00" fill="#000000">Phase 2</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_phase3</title>
<polygon fill="none" stroke="#000000" points="1739,-297 1739,-374 1853,-374 1853,-297 1739,-297"/>
<text text-anchor="middle" x="1796" y="-358.8" font-family="Times,serif" font-size="14.00" fill="#000000">Phase 3</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_final</title>
<polygon fill="none" stroke="#000000" points="1891,-298 1891,-373 2042,-373 2042,-298 1891,-298"/>
<text text-anchor="middle" x="1966.5" y="-357.8" font-family="Times,serif" font-size="14.00" fill="#000000">Tear down</text>
</g>
<!-- passive -->
<g id="node1" class="node">
<title>passive</title>
<polygon fill="none" stroke="#000000" points="317.5,-516 101.5,-516 101.5,-462 317.5,-462 317.5,-516"/>
<text text-anchor="middle" x="209.5" y="-500.8" font-family="Times,serif" font-size="14.00" fill="#000000">Passive network sniffing</text>
<text text-anchor="start" x="109.5" y="-469.8" font-family="Times,serif" font-size="14.00" fill="#000000">clw dumpcap &#45;i eth0 &#45;a duration:300</text>
</g>
<!-- portfast -->
<g id="node2" class="node">
<title>portfast</title>
<polygon fill="none" stroke="#000000" points="342,-408 77,-408 77,-354 342,-354 342,-408"/>
<text text-anchor="middle" x="209.5" y="-392.8" font-family="Times,serif" font-size="14.00" fill="#000000">Wait for switch port to enter forwarding state</text>
<text text-anchor="start" x="85" y="-361.8" font-family="Times,serif" font-size="14.00" fill="#000000">clw dumpcap &#45;i eth0 &#45;a duration:90</text>
</g>
<!-- passive&#45;&gt;portfast -->
<g id="edge1" class="edge">
<title>passive&#45;&gt;portfast</title>
<path fill="none" stroke="#000000" d="M209.5,-461.9308C209.5,-447.4388 209.5,-432.9468 209.5,-418.4548"/>
<polygon fill="#000000" stroke="#000000" points="213.0001,-418.4218 209.5,-408.4219 206.0001,-418.4219 213.0001,-418.4218"/>
</g>
<!-- discPing -->
<g id="node4" class="node">
<title>discPing</title>
<polygon fill="none" stroke="#000000" points="792.5,-519.5 506.5,-519.5 506.5,-450.5 792.5,-450.5 792.5,-519.5"/>
<text text-anchor="middle" x="649.5" y="-504.3" font-family="Times,serif" font-size="14.00" fill="#000000">Initial Host Discovery</text>
<text text-anchor="start" x="514.5" y="-473.3" font-family="Times,serif" font-size="14.00" fill="#000000">clw ping &#45;4 &#45;n &#45;I eth0 &#45;L &#45;c 4 &#45;b 1.2.3.255</text>
<text text-anchor="start" x="514.5" y="-458.3" font-family="Times,serif" font-size="14.00" fill="#000000">clw ping &#45;4 &#45;n &#45;I eth0 &#45;L &#45;c 4 &#45;b 255.255.255.255</text>
</g>
<!-- passive&#45;&gt;discPing -->
<g id="edge3" class="edge">
<title>passive&#45;&gt;discPing</title>
</g>
<!-- excludes -->
<g id="node3" class="node">
<title>excludes</title>
<polygon fill="none" stroke="#000000" points="403,-299.5 16,-299.5 16,-200.5 403,-200.5 403,-299.5"/>
<text text-anchor="middle" x="209.5" y="-284.3" font-family="Times,serif" font-size="14.00" fill="#000000">Target Files (ROE excluded)</text>
<text text-anchor="start" x="24" y="-253.3" font-family="Times,serif" font-size="14.00" fill="#000000">psql &#45;d site &#45;A &#45;t &#45;c</text>
<text text-anchor="start" x="24" y="-238.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&quot;SELECT DISTINCT ip_net FROM playbook_roe_ip_nets</text>
<text text-anchor="start" x="24" y="-223.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;WHERE (NOT in_scope) AND (4 = family(ip_net))</text>
<text text-anchor="start" x="24" y="-208.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ORDER BY ip_net&quot; &gt;&gt; ~/.clw/ROE&#45;Excluded&#45;IPV4&#45;${UUID}</text>
</g>
<!-- portfast&#45;&gt;excludes -->
<g id="edge2" class="edge">
<title>portfast&#45;&gt;excludes</title>
<path fill="none" stroke="#000000" d="M209.5,-353.9848C209.5,-339.2656 209.5,-324.5463 209.5,-309.827"/>
<polygon fill="#000000" stroke="#000000" points="213.0001,-309.6367 209.5,-299.6367 206.0001,-309.6368 213.0001,-309.6367"/>
</g>
<!-- excludes&#45;&gt;discPing -->
<g id="edge4" class="edge">
<title>excludes&#45;&gt;discPing</title>
<path fill="none" stroke="#000000" d="M375.5516,-299.7168C388.4368,-307.5489 400.4963,-316.5838 411,-327 443.8766,-359.6027 415.0079,-392.5621 449,-424 462.9323,-436.8854 479.5104,-447.0524 497.0778,-455.0738"/>
<polygon fill="#000000" stroke="#000000" points="495.7776,-458.3247 506.3458,-459.0759 498.5527,-451.8982 495.7776,-458.3247"/>
</g>
<!-- discNmap -->
<g id="node5" class="node">
<title>discNmap</title>
<polygon fill="none" stroke="#000000" points="842,-396.5 457,-396.5 457,-251.5 842,-251.5 842,-396.5"/>
<text text-anchor="middle" x="649.5" y="-381.3" font-family="Times,serif" font-size="14.00" fill="#000000">Host Discovery and IP Protocol Scans</text>
<text text-anchor="start" x="465" y="-350.3" font-family="Times,serif" font-size="14.00" fill="#000000">clw nmap &#160;&#160;&#160;&#45;n &#45;e eth0 &#45;sn &#45;PR &#45;T4 &#45;&#45;script &#39;(ip&#45;forwarding)&#39;</text>
<text text-anchor="start" x="465" y="-335.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;&#45;excludefile ~/.netmeld/playbook/ROE&#45;Excluded&#45;IPv4&#45;${UUID}</text>
<text text-anchor="start" x="465" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;1.2.3.0/24</text>
<text text-anchor="start" x="465" y="-289.3" font-family="Times,serif" font-size="14.00" fill="#000000">clw nmap &#160;&#160;&#160;&#45;n &#45;e eth0 &#45;sO &#45;PR &#45;T4</text>
<text text-anchor="start" x="465" y="-274.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;&#45;excludefile ~/.netmeld/playbook/ROE&#45;Excluded&#45;IPv4&#45;${UUID}</text>
<text text-anchor="start" x="465" y="-259.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;1.2.3.0/24</text>
</g>
<!-- discPing&#45;&gt;discNmap -->
<g id="edge5" class="edge">
<title>discPing&#45;&gt;discNmap</title>
<path fill="none" stroke="#000000" d="M649.5,-450.4839C649.5,-435.9008 649.5,-421.3177 649.5,-406.7346"/>
<polygon fill="#000000" stroke="#000000" points="653.0001,-406.6386 649.5,-396.6387 646.0001,-406.6387 653.0001,-406.6386"/>
</g>
<!-- targets -->
<g id="node6" class="node">
<title>targets</title>
<polygon fill="none" stroke="#000000" points="1254,-433.5 896,-433.5 896,-214.5 1254,-214.5 1254,-433.5"/>
<text text-anchor="middle" x="1075" y="-418.3" font-family="Times,serif" font-size="14.00" fill="#000000">Target Files (Responding Hosts)</text>
<text text-anchor="start" x="904" y="-387.3" font-family="Times,serif" font-size="14.00" fill="#000000">psql &#45;d site &#45;A &#45;t &#45;c</text>
<text text-anchor="start" x="904" y="-372.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&quot;SELECT DISTINCT ia.ip_addr FROM raw_ip_addrs AS ia</text>
<text text-anchor="start" x="904" y="-357.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;JOIN tool_runs AS tr</text>
<text text-anchor="start" x="904" y="-342.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ON (ia.tool_run_id = tr.id)</text>
<text text-anchor="start" x="904" y="-327.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;JOIN playbook_roe_ip_nets AS roe</text>
<text text-anchor="start" x="904" y="-312.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ON (ia.ip_addr &lt;&lt;= roe.ip_net)</text>
<text text-anchor="start" x="904" y="-297.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;WHERE (ia.is_responding)</text>
<text text-anchor="start" x="904" y="-282.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;AND (4 = family(ia.ip_addr))</text>
<text text-anchor="start" x="904" y="-267.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;AND (roe.in_scope)</text>
<text text-anchor="start" x="904" y="-252.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;AND (ia.ip_addr &lt;&lt;= &#39;1.2.3.0/24&#39;)</text>
<text text-anchor="start" x="904" y="-237.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;ORDER BY ia.ip_addr&quot;</text>
<text text-anchor="start" x="904" y="-222.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&gt;&gt; ~/.netmeld/playbook/Responding&#45;Hosts&#45;IPv4&#45;${UUID}</text>
</g>
<!-- discNmap&#45;&gt;targets -->
<g id="edge6" class="edge">
<title>discNmap&#45;&gt;targets</title>
<path fill="none" stroke="#000000" d="M842.0202,-324C856.5924,-324 871.2924,-324 885.8433,-324"/>
<polygon fill="#000000" stroke="#000000" points="885.8898,-327.5001 895.8898,-324 885.8897,-320.5001 885.8898,-327.5001"/>
</g>
<!-- scans -->
<g id="node7" class="node">
<title>scans</title>
<polygon fill="none" stroke="#000000" points="1693,-517.5 1308,-517.5 1308,-130.5 1693,-130.5 1693,-517.5"/>
<text text-anchor="middle" x="1500.5" y="-502.3" font-family="Times,serif" font-size="14.00" fill="#000000">Port Scans (plus basic info gathering)</text>
<text text-anchor="start" x="1316" y="-471.3" font-family="Times,serif" font-size="14.00" fill="#000000">clw nmap &#160;&#160;&#160;&#45;n &#45;e eth0 &#45;sS &#45;PR &#45;T4 &#45;O</text>
<text text-anchor="start" x="1316" y="-456.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;&#45;script &#39;(banner or dns&#45;nsid or ntp&#45;info or rpcinfo or ssh&#45;hostkey</text>
<text text-anchor="start" x="1316" y="-441.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or ssh2&#45;enum&#45;algos or ssl&#45;cert or smtp&#45;commands</text>
<text text-anchor="start" x="1316" y="-426.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or smb&#45;os&#45;discovery or smbv2&#45;enabled or vnc&#45;info)&#39;</text>
<text text-anchor="start" x="1316" y="-411.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;p `nmdb&#45;export&#45;port&#45;list &#45;&#45;tcp&#45;all`</text>
<text text-anchor="start" x="1316" y="-396.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;iL ~/.netmeld/playbook/Responding&#45;Hosts&#45;IPv4&#45;${UUID}</text>
<text text-anchor="start" x="1316" y="-381.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;&#45;excludefile ~/.netmeld/playbook/ROE&#45;Excluded&#45;IPv4&#45;${UUID}</text>
<text text-anchor="start" x="1316" y="-350.3" font-family="Times,serif" font-size="14.00" fill="#000000">clw nmap &#160;&#160;&#160;&#45;n &#45;e eth0 &#45;sU &#45;PR &#45;T4 &#45;O</text>
<text text-anchor="start" x="1316" y="-335.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;&#45;script &#39;(banner or dns&#45;nsid or ntp&#45;info or rpcinfo or ssh&#45;hostkey</text>
<text text-anchor="start" x="1316" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or ssh2&#45;enum&#45;algos or ssl&#45;cert or smtp&#45;commands</text>
<text text-anchor="start" x="1316" y="-305.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or smb&#45;os&#45;discovery or smbv2&#45;enabled or vnc&#45;info)&#39;</text>
<text text-anchor="start" x="1316" y="-290.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;p `nmdb&#45;export&#45;port&#45;list &#45;&#45;udp`</text>
<text text-anchor="start" x="1316" y="-275.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;iL ~/.netmeld/playbook/Responding&#45;Hosts&#45;IPv4&#45;${UUID}</text>
<text text-anchor="start" x="1316" y="-260.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;&#45;excludefile ~/.netmeld/playbook/ROE&#45;Excluded&#45;IPv4&#45;${UUID}</text>
<text text-anchor="middle" x="1500.5" y="-229.3" font-family="Times,serif" font-size="14.00" fill="#000000">Service Scans (most scripts enabled)</text>
<text text-anchor="start" x="1316" y="-198.3" font-family="Times,serif" font-size="14.00" fill="#000000">clw nmap &#160;&#160;&#160;&#45;n &#45;e eth0 &#45;sS &#45;PR &#45;T4 &#45;A</text>
<text text-anchor="start" x="1316" y="-183.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;&#45;script &#39;((default or discovery) and not (external or brute or dos))&#39;</text>
<text text-anchor="start" x="1316" y="-168.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;p `nmdb&#45;export&#45;port&#45;list &#45;&#45;tcp&#45;all`</text>
<text text-anchor="start" x="1316" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;iL ~/.netmeld/playbook/Responding&#45;Hosts&#45;IPv4&#45;${UUID}</text>
<text text-anchor="start" x="1316" y="-138.3" font-family="Times,serif" font-size="14.00" fill="#000000"> &#160;&#45;&#45;excludefile ~/.netmeld/playbook/ROE&#45;Excluded&#45;IPv4&#45;${UUID}</text>
</g>
<!-- targets&#45;&gt;scans -->
<g id="edge7" class="edge">
<title>targets&#45;&gt;scans</title>
<path fill="none" stroke="#000000" d="M1254.2171,-324C1268.6109,-324 1283.2148,-324 1297.7562,-324"/>
<polygon fill="#000000" stroke="#000000" points="1297.81,-327.5001 1307.81,-324 1297.81,-320.5001 1297.81,-327.5001"/>
</g>
<!-- manual -->
<g id="node8" class="node">
<title>manual</title>
<polygon fill="none" stroke="#000000" points="1845,-343 1747,-343 1747,-305 1845,-305 1845,-343"/>
<text text-anchor="middle" x="1796" y="-327.8" font-family="Times,serif" font-size="14.00" fill="#000000">Manual testing</text>
<text text-anchor="middle" x="1796" y="-312.8" font-family="Times,serif" font-size="14.00" fill="#000000">or script</text>
</g>
<!-- scans&#45;&gt;manual -->
<g id="edge8" class="edge">
<title>scans&#45;&gt;manual</title>
<path fill="none" stroke="#000000" d="M1693.0633,-324C1708.582,-324 1723.3722,-324 1736.6548,-324"/>
<polygon fill="#000000" stroke="#000000" points="1736.9691,-327.5001 1746.9691,-324 1736.9691,-320.5001 1736.9691,-327.5001"/>
</g>
<!-- destroy -->
<g id="node9" class="node">
<title>destroy</title>
<polygon fill="none" stroke="#000000" points="2034,-342 1899,-342 1899,-306 2034,-306 2034,-342"/>
<text text-anchor="middle" x="1966.5" y="-320.3" font-family="Times,serif" font-size="14.00" fill="#000000">Deconfigure interface</text>
</g>
<!-- manual&#45;&gt;destroy -->
<g id="edge9" class="edge">
<title>manual&#45;&gt;destroy</title>
<path fill="none" stroke="#000000" d="M1845.3157,-324C1858.9002,-324 1873.9749,-324 1888.747,-324"/>
<polygon fill="#000000" stroke="#000000" points="1888.9035,-327.5001 1898.9034,-324 1888.9034,-320.5001 1888.9035,-327.5001"/>
</g>
</g>
</svg>
